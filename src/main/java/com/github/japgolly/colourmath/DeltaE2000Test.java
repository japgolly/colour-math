package com.github.japgolly.colourmath;

import static org.fest.assertions.api.Assertions.assertThat;
import static org.fest.assertions.api.Assertions.offset;

import java.util.Arrays;
import java.util.Collection;

import lombok.RequiredArgsConstructor;

import org.fest.assertions.data.Offset;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.Parameterized;

/**
 * Tests the CIEDE2000 calculation.
 * <p>
 * Test data taken from: http://www.ece.rochester.edu/~gsharma/ciede2000/
 * 
 * @since 10/01/2013
 */
@RunWith(Parameterized.class)
@RequiredArgsConstructor
public class DeltaE2000Test {

	private final double l1, a1, b1;
	private final double l2, a2, b2;
	private final double dE2000;
	private Offset<Double> tolerance = offset(0.0000000000001);

	@Parameterized.Parameters
	public static Collection<?> testData() {
		return Arrays.asList(new Object[][] { //
				{ 50, 2.6772, -79.7751, 50, 0, -82.7485, 2.04245968015657 }, //
						{ 50, 3.1571, -77.2803, 50, 0, -82.7485, 2.86151017474749 }, //
						{ 50, 2.8361, -74.02, 50, 0, -82.7485, 3.44119059869071 }, //
						{ 50, -1.3802, -84.2814, 50, 0, -82.7485, 0.999998864752455 }, //
						{ 50, -1.1848, -84.8006, 50, 0, -82.7485, 1.00000470107433 }, //
						{ 50, -0.9009, -85.5211, 50, 0, -82.7485, 1.0000129676236 }, //
						{ 50, 0, 0, 50, -1, 2, 2.36685881917175 }, //
						{ 50, -1, 2, 50, 0, 0, 2.36685881917175 }, //
						{ 50, 2.49, -0.001, 50, -2.49, 0.00090000000000001, 7.17917201134898 }, //
						{ 50, 2.49, -0.001, 50, -2.49, 0.00100000000000001, 7.17916264000156 }, //
						{ 50, 2.49, -0.001, 50, -2.49, 0.00110000000000001, 7.21947215228575 }, //
						{ 50, 2.49, -0.001, 50, -2.49, 0.00120000000000001, 7.2194742124714 }, //
						{ 50, -0.001, 2.49, 50, 0.00090000000000001, -2.49, 4.80452168577475 }, //
						{ 50, -0.001, 2.49, 50, 0.00100000000000001, -2.49, 4.80452450821177 }, //
						{ 50, -0.001, 2.49, 50, 0.00110000000000001, -2.49, 4.74607111380668 }, //
						{ 50, 2.5, 0, 50, 0, -2.5, 4.30648209582706 }, //
						{ 50, 2.5, 0, 73, 25, -18, 27.1492313007463 }, //
						{ 50, 2.5, 0, 61, -5, 29, 22.8976924698069 }, //
						{ 50, 2.5, 0, 56, -27, -3, 31.9030046468639 }, //
						{ 50, 2.5, 0, 58, 24, 15, 19.4535214333926 }, //
						{ 50, 2.5, 0, 50, 3.17359627958174, 0.585353074312861, 0.999999923668473 }, //
						{ 50, 2.5, 0, 50, 3.29722210201375, 0.00000000794802472674044, 0.999999971013805 }, //
						{ 50, 2.5, 0, 50, 1.86342083563163, 0.575651399700511, 1.00000002878271 }, //
						{ 50, 2.5, 0, 50, 3.25917204763466, 0.334992094209014, 0.999999976476543 }, //
						{ 60.2574, -34.0099, 36.2677, 60.4626, -34.1751, 39.4387, 1.26442001359919 }, //
						{ 63.0109, -31.0961, -5.8663, 62.8187, -29.7946, -4.0864, 1.26295929826223 }, //
						{ 61.2901, 3.7196, -5.3901, 61.4292, 2.248, -4.962, 1.87307050011836 }, //
						{ 35.0831, -44.1164, 3.7933, 35.0232, -40.0716, 1.5901, 1.86449523415946 }, //
						{ 22.7233, 20.0904, -46.694, 23.0331, 14.973, -42.5619, 2.03725826970897 }, //
						{ 36.4612, 47.858, 18.3852, 36.2715, 50.5065, 21.2231, 1.4145779224938 }, //
						{ 90.8027, -2.0831, 1.441, 91.1528, -1.6435, 0.0447, 1.44412907809302 }, //
						{ 90.9257, -0.5406, -0.9208, 88.6381, -0.8985, -0.7239, 1.53811700543968 }, //
						{ 6.7747, -0.2908, -2.4247, 5.8714, -0.0985, -2.2286, 0.637727671884115 }, //
						{ 2.0776, 0.0795, -1.135, 0.9033, -0.0636, -0.5514, 0.908232839602525 }, //
				});
	}

	@Test
	public void test() {
		final ColourLab c1 = ColourFactory.getInstance().LAB(l1, a1, b1);
		final ColourLab c2 = ColourFactory.getInstance().LAB(l2, a2, b2);
		double r = c1.deltaE_2000(c2);
		assertThat(r).isEqualTo(dE2000, tolerance);
	}
}
